<div class="flex h-screen w-full">
  <!-- Panel izquierdo: Agregar componentes -->
  <aside class="w-[20%] bg-gray-100 p-4 border-r border-gray-300">
    <h2 class="text-lg font-semibold mb-4">Componentes</h2>
    <button class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700" (click)="addComponent('Caja DIV')">
      Agregar Caja DIV
    </button>

    <!-- Mostrar JSON en el panel derecho -->
    <div class="mt-6">
      <h3 class="text-sm font-semibold mb-2">JSON del Canvas</h3>
      <pre class="text-xs bg-gray-100 p-2 rounded h-40 overflow-auto whitespace-pre-wrap">
{{ components | json }}
  </pre>
    </div>

    <!-- Botón para ver HTML -->
    <button class="mt-4 w-full bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700" (click)="openHtmlModal()">
      Ver HTML generado
    </button>

  </aside>





  <!-- Panel central: Canvas (BODY) -->
  <div #canvas class="flex-1 bg-white relative border border-gray-300 overflow-auto"
    (contextmenu)="onCanvasContextMenu($event) " (mousemove)="onMouseMove($event)" (mouseup)="onMouseUp()">
    <h2 class="text-center font-semibold py-2 border-b">Canvas: &lt;body&gt;</h2>

    <!-- Renderizado de componentes -->
    <ng-container *ngFor="let comp of components">
      <ng-container *ngTemplateOutlet="renderComponent; context: { comp: comp }"></ng-container>
    </ng-container>


    <!-- Menú contextual -->
    <div *ngIf="contextMenu.visible" [style.left.px]="contextMenu.x" [style.top.px]="contextMenu.y"
      class="fixed bg-white border rounded shadow z-[1000]">
      <button (click)="addChild(contextMenu.targetId)" class="block px-4 py-2 hover:bg-gray-100 w-full text-left">
        Agregar hijo
      </button>
      <button (click)="removeComponent(contextMenu.targetId)"
        class="block px-4 py-2 hover:bg-gray-100 w-full text-left">
        Eliminar
      </button>
    </div>

  </div>






  <!-- Panel derecho: Propiedades -->
  <aside class="w-[20%] bg-gray-50 p-4 border-l border-gray-300">
    <h2 class="text-lg font-semibold mb-4">Propiedades</h2>
    <div *ngIf="selectedComponent">
      <label class="block mb-1">Ancho</label>
      <input [(ngModel)]="selectedComponent.style.width" type="text" class="w-full border p-1 mb-2">

      <label class="block mb-1">Alto</label>
      <input [(ngModel)]="selectedComponent.style.height" type="text" class="w-full border p-1 mb-2">

      <label class="block mb-1">Color fondo</label>
      <input [(ngModel)]="selectedComponent.style.backgroundColor" type="color" class="w-full border p-1 mb-2">
    </div>
  </aside>

  <!-- Template de renderizado recursivo -->
  <ng-template #renderComponent let-comp="comp">
    <div class="border p-2 text-center cursor-move" [ngStyle]="comp.style"
      [style.position]="comp.parentId ? 'absolute' : 'relative'" [style.min-width.px]="50" [style.min-height.px]="40"
      (mousedown)="onMouseDown($event, comp)" (click)="selectComponent(comp, $event)"
      (contextmenu)="onComponentContextMenu($event, comp.id)">
      {{ comp.label }}

      <ng-container *ngIf="comp.children">
        <ng-container *ngFor="let child of comp.children">
          <ng-container *ngTemplateOutlet="renderComponent; context: { comp: child }"></ng-container>
        </ng-container>
      </ng-container>
    </div>
  </ng-template>
</div>






<!-- Modal HTML generado -->
<div *ngIf="isModalOpen" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center">
  <div class="bg-white rounded shadow-lg p-6 w-[80%] max-h-[80%] overflow-auto relative">
    <h2 class="text-lg font-semibold mb-4">Código HTML Generado</h2>
    <pre class="text-sm bg-gray-100 p-4 rounded overflow-auto whitespace-pre-wrap max-h-[60vh]">
{{ exportHtml() }}
    </pre>
    <button class="absolute top-2 right-2 text-red-500 hover:text-red-700" (click)="isModalOpen = false">
      ✖
    </button>
  </div>
</div>